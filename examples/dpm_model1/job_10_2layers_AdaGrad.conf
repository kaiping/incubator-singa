name: "nuh_model1 - MultiMlpNaiiveCombine - after pca preprocessing - alpha1 = 0.33, alpha2 = 0.33, alpha3 = 0.33"
train_steps:5600
test_steps:3
test_freq:70
disp_freq:10
alg: kBP
updater{
  type: kAdaGrad
  weight_decay:10
  learning_rate{
  base_lr: 0.01
  type: kFixed
  }
}

neuralnet {
  layer {
    name: "data"
    type: kShardData
    sharddata_conf {
      path: "examples/dpm_model1/dpm_model1_train_shard"
      # TODO(kaiping) modify the batchsize here
      batchsize: 180
    }
    exclude: kTest
  }

  layer {
    name: "data"
    type: kShardData
    sharddata_conf {
      path: "examples/dpm_model1/dpm_model1_test_shard"
      batchsize: 180
    }
    exclude: kTrain
  }

  layer{
    name:"feature_parser"
    type: kDPMMultiDestFeatureParser
    dpm_multidest_featureparser_conf{
      feature_num_win1: 75
      feature_num_win2: 130
      feature_num_win3: 240
      window_num: 3
    }
    srclayers: "data"
  }


  layer{
    name: "label_parser"
    type: kDPMLabelParser
    srclayers: "data"
  }

  # the special part for Model1
  # 3 windows - corresponding to 3 innerproduct layers starting with "fc1"
  layer{
    name: "fc1_window1"
    type: kInnerProduct
    srclayers:"feature_parser"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2500
    }
    param{
      name: "w1_window1"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b1_window1"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc1_window2"
    type: kInnerProduct
    srclayers:"feature_parser"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2500
    }
    param{
      name: "w1_window2"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b1_window2"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc1_window3"
    type: kInnerProduct
    srclayers:"feature_parser"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2500
    }
    param{
      name: "w1_window3"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b1_window3"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  # 3 windows - corresponding to 3 tanh layers starting with "a1"

  layer{
    name: "tanh1_window1"
    type: kTanh
    srclayers:"fc1_window1"
  }

  layer{
    name: "tanh1_window2"
    type: kTanh
    srclayers:"fc1_window2"
  }

  layer{
    name: "tanh1_window3"
    type: kTanh
    srclayers:"fc1_window3"
  }

  # 3 windows - corresponding to 3 innerproduct layers starting with "fc2"
  layer{
    name: "fc2_window1"
    type: kInnerProduct
    srclayers:"tanh1_window1"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2000
    }
    param{
      name: "w2_window1"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b2_window1"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc2_window2"
    type: kInnerProduct
    srclayers:"tanh1_window2"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2000
    }
    param{
      name: "w2_window2"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b2_window2"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc2_window3"
    type: kInnerProduct
    srclayers:"tanh1_window3"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 2000
    }
    param{
      name: "w2_window3"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b2_window3"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  # 3 windows - corresponding to 3 tanh layers starting with "a2"

  layer{
    name: "tanh2_window1"
    type: kTanh
    srclayers:"fc2_window1"
  }

  layer{
    name: "tanh2_window2"
    type: kTanh
    srclayers:"fc2_window2"
  }

  layer{
    name: "tanh2_window3"
    type: kTanh
    srclayers:"fc2_window3"
  }

    # 3 windows - corresponding to 3 innerproduct layers starting with "fc3"
  layer{
    name: "fc3_window1"
    type: kInnerProduct
    srclayers:"tanh2_window1"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 4
    }
    param{
      name: "w3_window1"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b3_window1"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc3_window2"
    type: kInnerProduct
    srclayers:"tanh2_window2"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 4
    }
    param{
      name: "w3_window2"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b3_window2"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }

  layer{
    name: "fc3_window3"
    type: kInnerProduct
    srclayers:"tanh2_window3"
    # TODO(kaiping) modify the conf here
    innerproduct_conf{
      num_output: 4
    }
    param{
      name: "w3_window3"
      init {
        type: kUniform
        low:-0.05
        high:0.05
      }
    }
    param{
      name: "b3_window3"
      init {
        type : kUniform
        low: -0.05
        high:0.05
      }
    }
  }


  layer{
    name: "loss"
    type:kDPMCombineSoftmaxLoss
    dpm_combine_softmaxloss_conf{
      topk:1
    }
    srclayers:"fc3_window1"
    srclayers:"fc3_window2"
    srclayers:"fc3_window3"
    srclayers:"label_parser"
  }
}
cluster {
  nworker_groups: 1
  nserver_groups: 1
  workspace: "examples/dpm_model1"
}
